[
    {marvin, [
        {discord, [
            {token, <<"${MARVIN_APP_ACCESS_TOKEN}">>},
            {api, [
                {host, "${MARVIN_APP_API_HOST}"},
                {port, "${MARVIN_APP_API_PORT}"},
                {root_url, "${MARVIN_APP_API_ROOT_URL}"},
                {gateway_url, "${MARVIN_APP_API_GATEWAY_URL}"}
            ]},
            {gateway, [
                {port, "${MARVIN_APP_GATEWAY_PORT}"},
                {protocol_version, "${MARVIN_APP_GATEWAY_PROTOVER}"},
                {compress, "${MARVIN_APP_GATEWAY_COMPRESS}"},
                {large_threshold, "${MARVIN_APP_GATEWAY_LARGE_THRESHOLD}"}
            ]}
        ]},
        {dialogflow, [
            {token, <<"${MARVIN_APP_DIALOGFLOW_ACCESS_TOKEN}">>},
            {api, [
                {host, "${MARVIN_APP_DIALOGFLOW_HOST}"},
                {port, "${MARVIN_APP_DIALOGFLOW_PORT}"},
                {root_url, "${MARVIN_APP_DIALOGFLOW_ROOT_URL}"}
            ]}
        ]},
        {system_info, [
            {library_name, <<"${MARVIN_APP_SYSINFO_LIBRARY_NAME}">>},
            {library_version, <<"{{release_version}}">>},
            {library_web, <<"${MARVIN_APP_SYSINFO_LIBRARY_WEB}">>}
        ]},
        {guild, [
            {config_root, <<"${MARVIN_APP_GUILD_CONFIG_ROOT}">>},
            {config_filename_template, <<"${MARVIN_APP_GUILD_CONFIG_FILENAME_TEMPLATE}">>}
        ]},
        {plugin, [
            {config_root, <<"${MARVIN_APP_PLUGIN_CONFIG_ROOT}">>},
            {config_filename_template, <<"${MARVIN_APP_PLUGIN_CONFIG_FILENAME_TEMPLATE}">>}
        ]},
        {db, [
            {pool_size, "${MARVIN_STORAGE_DB_POOL_SIZE}"},
            {pool_overflow, "${MARVIN_STORAGE_DB_POOL_OVERFLOW}"},
            {name, <<"${MARVIN_STORAGE_DB_NAME}">>},
            {host, "${MARVIN_STORAGE_DB_HOST}"},
            {port, "${MARVIN_STORAGE_DB_PORT}"}
        ]}
    ]},
    {kernel, [
        {logger_sasl_compatible, false},
        {logger_level, debug},
        {logger, [
            %% Console logger
            {handler, default, logger_std_h, #{
                level => emergency,
                formatter => {marvin_log_f, #{
                    map_depth => 5,
                    term_depth => 50
                }}
            }},
            %% Disk logger for errors
            {handler, disk_error, logger_disk_log_h, #{
                level => error,
                formatter => {marvin_log_f, #{
                    map_depth => 3,
                    term_depth => 50
                }},
                config => #{
                    file => "${MARVIN_APP_LAGER_LOG_ROOT}/lgr_error.log",
                    type => wrap,
                    max_no_files => 10,
                    max_no_bytes => 52428800 % 10 x 5mb
                }
            }},
            %% Disk logger for info
            {handler, disk_info, logger_disk_log_h, #{
                level => info,
                formatter => {marvin_log_f, #{
                    map_depth => 3,
                    term_depth => 50
                }},
                config => #{
                    file => "${MARVIN_APP_LAGER_LOG_ROOT}/lgr_info.log",
                    type => wrap,
                    max_no_files => 10,
                    max_no_bytes => 52428800 % 10 x 5mb
                }
            }},
            %% Disk logger for info
            {handler, disk_debug, logger_disk_log_h, #{
                level => debug,
                formatter => {marvin_log_f, #{
                    map_depth => 3,
                    term_depth => 50
                }},
                config => #{
                    file => "${MARVIN_APP_LAGER_LOG_ROOT}/lgr_debug.log",
                    type => wrap,
                    max_no_files => 10,
                    max_no_bytes => 52428800 % 10 x 5mb
                }
            }}

            %% Synchronous Audit logs
%%            {handler, audit_log, logger_disk_log_h,
%%                #{config => #{
%%                    file => "logs/lgr_audit",
%%                    type => wrap,
%%                    max_no_files => 50,
%%                    max_no_bytes => 52428800, % 50 x 5mb
%%                    sync_mode_qlen => 0, % handle all events synchronously
%%                    filesync_repeat_interval => 100, % fsync after 100ms when a change is made
%%                    %% drop overload control
%%                    drop_mode_qlen => 100000000, % ridiculously large queue before we drop
%%                    flush_qlen => 100000001, % ensure we pretty much never drop silently
%%                    burst_limit_enable => false, % no burst protection
%%                    overload_kill_enable => false % kill the whole node, not just the logger
%%                },
%%                    %% only keep what you must
%%                    filters => [
%%                    {audit_filter, {fun my_project:audit_filter/2, state}}
%%                ],
%%                    filter_default => stop,
%%                    %% Keep structured logs to one line
%%                    formatter => {flatlog, #{
%%                    map_depth => 3,
%%                    term_depth => 500 % bigger term depth
%%                }}
%%                }
%%            }
        ]}
    ]},
    {sasl, [
        {utc_log, true},
        {sasl_error_logger, false}
    ]}
].
